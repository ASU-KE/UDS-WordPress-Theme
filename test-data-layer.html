<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Layer Analytics Test</title>
    <!-- jQuery removed to test vanilla JS version -->
    <script>
        // Initialize dataLayer
        window.dataLayer = window.dataLayer || [];
        
        // Console log dataLayer pushes for testing
        const originalPush = window.dataLayer.push;
        window.dataLayer.push = function(event) {
            console.log('DataLayer Event Pushed:', event);
            originalPush.call(this, event);
        };
    </script>
</head>
<body>
    <h1>Data-Layer.js Analytics Test Page</h1>
    
    <h2>Test Elements with data-ga attributes:</h2>
    
    <!-- Button test -->
    <button data-ga="test button" data-ga-name="onclick" data-ga-event="button" data-ga-action="click" data-ga-type="button" data-ga-region="main content" data-ga-section="test">
        Test Button
    </button>
    
    <!-- Internal link test -->
    <a href="/test" data-ga="internal link test" data-ga-name="onclick" data-ga-event="link" data-ga-action="click" data-ga-type="internal link" data-ga-region="main content" data-ga-section="test">
        Internal Link Test
    </a>
    
    <!-- External link test -->
    <a href="https://google.com" data-ga="external link test" data-ga-name="onclick" data-ga-event="link" data-ga-action="click" data-ga-type="external link" data-ga-region="main content" data-ga-section="test">
        External Link Test
    </a>
    
    <!-- Modal test -->
    <button data-ga="modal open" data-ga-name="onclick" data-ga-event="button" data-ga-action="click" data-ga-type="modal open" data-ga-region="main content" data-ga-section="modal">
        Open Modal
    </button>
    
    <div id="console-output">
        <h3>Console Output:</h3>
        <div id="console-log" style="background: #f5f5f5; padding: 10px; min-height: 200px; font-family: monospace;"></div>
    </div>

    <script>
        // Vanilla JS version for testing
        function initDataLayerTracking() {
            // Ensure dataLayer exists
            window.dataLayer = window.dataLayer || [];

            // Add click event listener to document for elements with data-ga attributes
            document.addEventListener('click', function(event) {
                var element = event.target.closest('[data-ga]');
                if (!element) return;

                var eventData = {};

                // Base event structure
                eventData.event = 'gaEvent';
                eventData.eventCategory = 'engagement';
                eventData.eventAction = 'click';

                // Extract data-ga-* attributes
                var dataGa = element.getAttribute('data-ga');
                var dataGaName = element.getAttribute('data-ga-name');
                var dataGaEvent = element.getAttribute('data-ga-event');
                var dataGaAction = element.getAttribute('data-ga-action');
                var dataGaType = element.getAttribute('data-ga-type');
                var dataGaRegion = element.getAttribute('data-ga-region');
                var dataGaSection = element.getAttribute('data-ga-section');
                var dataGaText = element.getAttribute('data-ga-text');

                // Set event properties based on available data-ga attributes
                if (dataGa) {
                    eventData.eventLabel = dataGa;
                }

                if (dataGaName) {
                    eventData.eventName = dataGaName;
                }

                if (dataGaEvent) {
                    eventData.event = dataGaEvent;
                }

                if (dataGaAction) {
                    eventData.eventAction = dataGaAction;
                }

                if (dataGaType) {
                    eventData.eventCategory = dataGaType;
                    eventData.linkType = dataGaType;
                }

                if (dataGaRegion) {
                    eventData.region = dataGaRegion;
                }

                if (dataGaSection) {
                    eventData.section = dataGaSection;
                }

                if (dataGaText) {
                    eventData.text = dataGaText;
                }

                // Get link information if element is a link
                if (element.tagName.toLowerCase() === 'a') {
                    var href = element.getAttribute('href');
                    if (href) {
                        eventData.linkUrl = href;
                        
                        // Determine if internal or external link
                        if (href.indexOf('asu.edu') !== -1 || href.indexOf('/') === 0 || href.indexOf('#') === 0) {
                            eventData.linkType = eventData.linkType || 'internal link';
                        } else {
                            eventData.linkType = eventData.linkType || 'external link';
                        }
                    }
                }

                // Get button text or link text if not already specified
                if (!eventData.text && !dataGaText) {
                    var elementText = element.textContent.trim();
                    if (elementText) {
                        eventData.text = elementText;
                    }
                }

                // Add element type information
                eventData.elementType = element.tagName.toLowerCase();
                
                // Add timestamp
                eventData.timestamp = new Date().toISOString();

                // Push to dataLayer
                console.log('Data Layer Event:', eventData); // Debug logging
                window.dataLayer.push(eventData);
                
                // Display in UI for testing
                var consoleLog = document.getElementById('console-log');
                var logEntry = document.createElement('div');
                logEntry.innerHTML = '<div>' + new Date().toLocaleTimeString() + ': ' + JSON.stringify(eventData, null, 2) + '</div><hr>';
                consoleLog.appendChild(logEntry);
                
                // Prevent default for test links
                if (element.tagName.toLowerCase() === 'a') {
                    event.preventDefault();
                }
            });
        }

        // Initialize when document is ready
        document.addEventListener('DOMContentLoaded', function() {
            initDataLayerTracking();
            console.log('Data Layer Analytics initialized');
        });
    </script>
</body>
</html>